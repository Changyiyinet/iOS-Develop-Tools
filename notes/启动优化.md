
## App启动优化
https://time.geekbang.org/column/article/85331
https://juejin.im/post/5cff0ada6fb9a07edc0b4c3c?utm_source=gold_browser_extension
https://juejin.im/post/5db654fc5188257d606aaf2a?utm_source=gold_browser_extension
https://techblog.toutiao.com/2017/01/17/iosspeed/#more
https://mp.weixin.qq.com/s/jN3jaNrvXczZoYIRCWZs7w

http://yulingtianxia.com/blog/2016/10/30/Optimizing-App-Startup-Time/

二进制重排：  

http://yulingtianxia.com/blog/2019/09/01/App-Order-Files/

https://mp.weixin.qq.com/s/YDO0ALPQWujuLvuRWdX7dQ

https://mp.weixin.qq.com/s?__biz=MzI1MzYzMjE0MQ==&mid=2247485101&idx=1&sn=abbbb6da1aba37a04047fc210363bcc9&scene=21#wechat_redirect

https://juejin.im/post/5e1280fae51d41540e47ca450

##  App的启动耗时

### 介绍

App 的启动时间是体现其性能优劣的一个重要指标，启动时间越快用户的等待时间就越短，提升用户体验感，大厂应用甚至会做到“ 毫秒必究 ”。  

我们将 App 启动方式分为：

| 名称   | 说明                                                         |
| ------ | ------------------------------------------------------------ |
| 冷启动 | App 启动时，应用进程不在系统中（初次打开或程序被杀死），需要系统分配新的进程来启动应用。 |
| 热启动 | App 退回后台后，对应的进程还在系统中，启动则将应用返回前台展示。 |

本篇文章主要针对冷启动方式进行优化分析，介绍常用的检测工具及优化方法。

### 冷启动流程

Apple 官方的[《WWDC Optimizing App Startup Time》](https://developer.apple.com/videos/play/wwdc2016/406) 将 iOS 应用的启动可分为 pre-main 阶段和 main 两个阶段，最佳的启动速度是400ms以内，最慢不得大于20s，否则会被系统进程杀死（最低配置设备）。

按照正常用户使用体验，笔者认为还应包括首屏页面展示后才算是完成了整个启动流程，因此我们将 **App总启动流程 = pre-main + 执行main函数 + 首屏渲染（viewDidAppear）**。

#### pre-main 执行内容

- 加载可执行文件

  加载 `Mach-O` 格式文件，既 App 中所有的类编译后生成的格式为 `.o` 的目标文件的集合。

- 加载动态库
- Rebase和Bind操作
- Objc setup
- Initializers

#### main函数执行内容

#### 首屏渲染执行内容

## 优化方案

### 整体思路

- 解决现存的问题
- 后续开发的管控
- 完整的监控体系

### pre-main阶段

#### 检测方法

获得 main() 方法执行前的耗时比较简单，通过 Xcode 自带的测量方法既可以。将 Xcode 中 Edit scheme -> Run -> Environment Variables 将环境变量 `DYLD_PRINT_STATISTICS` 或 `DYLD_PRINT_STATISTICS_DETAILS`  设为 `1` 即可获得每项内容的耗时：

```
// DYLD_PRINT_STATISTICS

// DYLD_PRINT_STATISTICS_DETAILS

```



 ####  优化手段

### 执行main函数阶段

#### 检测方法

#### 优化手段

### 首屏渲染阶段

#### 检测方法

#### 优化手段







## 工具

- System Trace

- Time Profiler

  https://mp.weixin.qq.com/s/wTF3JSFH5b2zIUYAbnC-Bw

  